package VulnerabilityDetector;

import java.util.Map;
import VulnerabilityDetector.TestResult;
import java.lang.reflect.Method;
import java.util.List;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import Tools.*;
import java.lang.reflect.InvocationTargetException;
/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 *
 * @author Víctor Rebollo Pérez
 */
/*
Cada test tiene un nombre, un código para testear información // En función del SO se ejecutará de una forma u otra
Recogera el String y lo formateará en un formato legible creando mensajes de aviso seguridad y todo eso
*/


/*VulnerabilityScan tiene biblioteca de test que puede ejecutar en cada sistema operativo*/
/*List<Vulnerability> lista_Vulnerabilidades*/


public abstract class Test {
    List<String> SO;
    String VulnerabilityID;
    String VulnerabilityName;
    List<String> CommandExecuter;
    JSONObject Commands; 
    TestResult result;
    
    
    // LO que falta: run test y quitar cosas temporales
    // Crear createResult en cada uno de los test y crear un test temporal con el otro
    // PRobar el test facilon
    // Añadir varios y probarlos
   
    public Test(Map testData){
        SO = (List<String>) testData.get("SO");
        VulnerabilityID =  (String) testData.get("VulnerabilityID");
        VulnerabilityName =  (String) testData.get("VulnerabilityName");
        CommandExecuter = (List<String>) testData.get("CommandExecuter");
        Commands = (JSONObject) testData.get("Commands");
        result = new TestResult();
    }
    TestResult runTest( String SO) throws NoSuchMethodException, IllegalAccessException, IllegalArgumentException, InvocationTargetException{
        String output = "";
        // Parseamos el SO . find windows linus etc
        // Comprobar si el test tiene en SO All si lo tiene, directamente ejecutar eso, si no switch
                       System.out.println("SO:  " + SO );

        switch(SO){
            case "windows":
            break;
            case "linux":
                System.out.println("Qsadfasdfjkl");
            break;
        }
            
            
            
        if(this.Commands.get("All") != null){
            tools t = new tools();
            List<String> commands = (List<String>) Commands.get("All");
            for (String command : commands) {
                Method m = Tools.tools.class.getMethod(command);
                output += (String) m.invoke(t);
            }
        }
        else{
            String OS_run = "Windows";
            switch(OS_run){
                case "Windows": System.out.println("fdsafas");
            }        
        }
        result.setOutput(output);
        createResult();   
        return result;
    }
    TestResult getResult(){
        return result;
    }
    abstract void createResult();
}




